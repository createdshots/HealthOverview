<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In | HealthOverview</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="/firebaseConfig.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    /* Animated gradient background */
    .animated-bg {
      background: linear-gradient(120deg, #e0e7ef 0%, #ede9fe 40%, #e0e7ef 100%);
      background-size: 200% 200%;
      animation: gradientMove 8s ease-in-out infinite alternate;
      position: relative;
      overflow: hidden;
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    /* Floating shapes animation */
    .float-shape {
      position: absolute;
      opacity: 0.13;
      pointer-events: none;
      z-index: 0;
      animation: floatY 7s ease-in-out infinite alternate;
    }
    .float-shape2 {
      animation-delay: 2s;
      animation-duration: 10s;
    }
    .float-shape3 {
      animation-delay: 4s;
      animation-duration: 12s;
    }
    @keyframes floatY {
      0% { transform: translateY(0) scale(1); }
      100% { transform: translateY(-30px) scale(1.08); }
    }
    /* Floating particles animation */
    .particle {
      position: absolute;
      opacity: 0.08;
      pointer-events: none;
      z-index: 1;
      border-radius: 50%;
      animation: particleFloat 15s linear infinite;
    }
    .particle2 {
      animation-delay: 3s;
      animation-duration: 18s;
    }
    .particle3 {
      animation-delay: 6s;
      animation-duration: 12s;
    }
    .particle4 {
      animation-delay: 9s;
      animation-duration: 20s;
    }
    .particle5 {
      animation-delay: 12s;
      animation-duration: 16s;
    }
    @keyframes particleFloat {
      0% { 
        transform: translateY(100vh) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.08;
      }
      90% {
        opacity: 0.08;
      }
      100% { 
        transform: translateY(-100px) translateX(50px) rotate(360deg);
        opacity: 0;
      }
    }
    /* Subtle greyscale with color for headline */
    .rainbow-text {
      background: linear-gradient(90deg, #444 0%, #6366f1 40%, #444 60%, #a78bfa 100%);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: rainbowFade 6s ease-in-out infinite alternate;
      filter: grayscale(0.4) contrast(1.1);
    }
    @keyframes rainbowFade {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
  </style>
</head>
<body class="min-h-screen flex">
  <!-- Left: Animated Mission -->
  <div class="hidden md:flex w-1/2 animated-bg items-center justify-center relative">
    <!-- Animated floating shapes -->
    <svg width="340" height="340" class="float-shape" style="top:3rem;left:2rem;">
      <circle cx="170" cy="170" r="160" fill="#6366f1" />
    </svg>
    <svg width="220" height="220" class="float-shape float-shape2" style="bottom:2rem;right:3rem;">
      <rect width="220" height="220" rx="70" fill="#a78bfa" />
    </svg>
    <svg width="120" height="120" class="float-shape float-shape3" style="top:8rem;right:6rem;">
      <ellipse cx="60" cy="60" rx="55" ry="45" fill="#f472b6" />
    </svg>
    
    <!-- Floating particles layer -->
    <div class="particle" style="width: 8px; height: 8px; background: #6366f1; left: 10%; animation-delay: 0s;"></div>
    <div class="particle particle2" style="width: 12px; height: 12px; background: #a78bfa; left: 25%; animation-delay: 3s;"></div>
    <div class="particle particle3" style="width: 6px; height: 6px; background: #f472b6; left: 45%; animation-delay: 6s;"></div>
    <div class="particle particle4" style="width: 10px; height: 10px; background: #8b5cf6; left: 65%; animation-delay: 9s;"></div>
    <div class="particle particle5" style="width: 14px; height: 14px; background: #c084fc; left: 80%; animation-delay: 12s;"></div>
    <div class="particle" style="width: 7px; height: 7px; background: #6366f1; left: 15%; animation-delay: 15s;"></div>
    <div class="particle particle2" style="width: 9px; height: 9px; background: #a78bfa; left: 35%; animation-delay: 18s;"></div>
    <div class="particle particle3" style="width: 11px; height: 11px; background: #f472b6; left: 55%; animation-delay: 21s;"></div>
    <div class="particle particle4" style="width: 5px; height: 5px; background: #8b5cf6; left: 75%; animation-delay: 24s;"></div>
    <div class="particle particle5" style="width: 13px; height: 13px; background: #c084fc; left: 90%; animation-delay: 27s;"></div>
    
    <div class="z-10 max-w-lg mx-auto text-center px-8">
      <h1 class="text-4xl font-extrabold mb-4 rainbow-text">Empowering our<br>Disabled Community</h1>
      <p class="text-lg text-gray-700 mb-6">HealthOverview helps you monitor symptoms, spot trends, and take control of your health journey. Designed for people with chronic conditions, by people who understand.</p>
      <ul class="text-left text-base text-gray-600 space-y-2">
        <li>✔️ Log symptoms and medical visits</li>
        <li>✔️ Track your conditions with personalized questions</li>
        <li>✔️ Visualize your progress and trends</li>
        <li>✔️ Your data, your privacy, always</li>
      </ul>
    </div>
  </div>
  <!-- Right: Auth Options -->
  <div class="flex flex-col w-full md:w-1/2 justify-center items-center bg-white min-h-screen p-8 relative">
    <div class="w-full max-w-md mx-auto bg-white rounded-xl shadow-lg p-8">
      <div class="mb-8 text-center">
        <img src="/logo.svg" alt="HealthOverview logo" class="mx-auto mb-2 w-14 h-14">
        <h2 class="text-2xl font-bold text-gray-900 mb-1">Sign in to HealthOverview</h2>
        <p class="text-gray-600 text-sm">Start tracking your health journey today.</p>
      </div>
      <div class="space-y-4">
        <button id="google-signin-btn" class="w-full flex items-center justify-center gap-2 bg-white border border-gray-300 rounded-lg py-2 font-semibold text-gray-700 hover:bg-gray-50 shadow transition">
          <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" class="w-5 h-5"> Sign in with Google
        </button>
        <button id="microsoft-signin-btn" class="w-full flex items-center justify-center gap-2 bg-white border border-gray-300 rounded-lg py-2 font-semibold text-gray-700 hover:bg-gray-50 shadow transition">
          <svg class="w-5 h-5" viewBox="0 0 24 24"><rect fill="#F25022" x="1" y="1" width="10" height="10"/><rect fill="#7FBA00" x="13" y="1" width="10" height="10"/><rect fill="#00A4EF" x="1" y="13" width="10" height="10"/><rect fill="#FFB900" x="13" y="13" width="10" height="10"/></svg> Sign in with Microsoft
        </button>
        <button id="email-signin-btn" class="w-full flex items-center justify-center gap-2 bg-white border border-gray-300 rounded-lg py-2 font-semibold text-gray-700 hover:bg-gray-50 shadow transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
          </svg> Sign in with Email or Magic Link
        </button>
        <button id="phone-signin-btn" class="w-full flex items-center justify-center gap-2 bg-white border border-gray-300 rounded-lg py-2 font-semibold text-gray-700 hover:bg-gray-50 shadow transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
          </svg> Sign in with Phone
        </button>
        <div class="flex items-center my-4">
          <div class="flex-grow border-t border-gray-200"></div>
          <span class="mx-2 text-gray-400 text-xs">or</span>
          <div class="flex-grow border-t border-gray-200"></div>
        </div>
        <button id="guest-signin-btn" class="w-full flex items-center justify-center gap-2 bg-gray-700 text-white rounded-lg py-2 font-semibold hover:bg-gray-800 transition">
          <span>Continue as Guest</span>
        </button>
      </div>
      <div class="mt-6 text-xs text-gray-400 text-center">By signing in, you agree to our <a href="#" class="underline hover:text-purple-600">Terms</a> and <a href="#" class="underline hover:text-purple-600">Privacy Policy</a>.</div>
      <div id="login-status-message" class="mt-4"></div>
    </div>
    <!-- Guest Disclaimer Modal -->
    <div id="guest-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm">
        <h3 class="text-lg font-bold text-gray-900 mb-2">Guest Session Disclaimer</h3>
        <p class="text-gray-700 mb-4">You are about to use HealthOverview as a guest. <span class="font-semibold text-red-600">Your data will not be saved</span> after you leave or refresh the page. For a full experience, please sign in with Google.</p>
        <div class="flex justify-end gap-2">
          <button id="guest-cancel-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Cancel</button>
          <button id="guest-continue-btn" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Continue as Guest</button>
        </div>
      </div>
    </div>
  </div>
  <script type="module">
    try {
      // Import Firebase modules
      const { FirebaseAuth } = await import('/js/auth.js');
      const { GoogleAuthProvider, OAuthProvider, signInWithPopup, signInAnonymously } = await import("https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js");

      const firebaseAuth = new FirebaseAuth();
      await firebaseAuth.initialize();
      const auth = firebaseAuth.getAuth();

      firebaseAuth.onAuthChange(({ user }) => {
        if (user) {
          console.log('User authenticated:', user);
          window.location.href = '/dashboard.html';
        }
      });

      function showLoginStatusMessage(message, type = 'error') {
        const msgDiv = document.getElementById('login-status-message');
        if (!msgDiv) return;
        msgDiv.textContent = message;
        msgDiv.className = type === 'error' ? 'text-red-600' : 'text-green-600';
        msgDiv.style.opacity = 1;
        setTimeout(() => { msgDiv.style.opacity = 0; }, 6000);
      }

      // Google Sign-In
      const googleBtn = document.getElementById('google-signin-btn');
      if (googleBtn) {
        googleBtn.addEventListener('click', async () => {
          try {
            showLoginStatusMessage('Signing in with Google...', 'success');
            const provider = new GoogleAuthProvider();
            provider.addScope('email');
            provider.addScope('profile');
            const result = await signInWithPopup(auth, provider);
            console.log('Google sign-in successful:', result.user);
          } catch (error) {
            console.error('Google sign-in error:', error);
            showLoginStatusMessage(`Google sign-in failed: ${error.message}`);
          }
        });
      }

      // Microsoft Sign-In  
      const msBtn = document.getElementById('microsoft-signin-btn');
      if (msBtn) {
        msBtn.addEventListener('click', async () => {
          try {
            showLoginStatusMessage('Signing in with Microsoft...', 'success');
            const provider = new OAuthProvider('microsoft.com');
            provider.addScope('mail.read');
            provider.addScope('user.read');
            const result = await signInWithPopup(auth, provider);
            console.log('Microsoft sign-in successful:', result.user);
          } catch (error) {
            console.error('Microsoft sign-in error:', error);
            showLoginStatusMessage(`Microsoft sign-in failed: ${error.message}`);
          }
        });
      }

      // Guest Sign-In
      const guestBtn = document.getElementById('guest-signin-btn');
      const guestModal = document.getElementById('guest-modal');
      const guestContinueBtn = document.getElementById('guest-continue-btn');
      const guestCancelBtn = document.getElementById('guest-cancel-btn');

      if (guestBtn) {
        guestBtn.addEventListener('click', () => {
          console.log('Guest button clicked');
          guestModal?.classList.remove('hidden');
        });
      }

      if (guestContinueBtn) {
        guestContinueBtn.addEventListener('click', async () => {
          try {
            console.log('Attempting anonymous sign-in...');
            showLoginStatusMessage('Signing in as guest...', 'success');
            
            const result = await signInAnonymously(auth);
            console.log('Anonymous sign-in successful:', result.user);
            
            showLoginStatusMessage('Signed in as guest successfully!', 'success');
            guestModal?.classList.add('hidden');
            
            // The onAuthChange callback should handle redirect
            setTimeout(() => {
              if (!window.location.href.includes('dashboard.html')) {
                window.location.href = '/dashboard.html';
              }
            }, 1000);
            
          } catch (error) {
            console.error('Anonymous sign-in error:', error);
            showLoginStatusMessage(`Guest sign-in failed: ${error.message}`);
          }
        });
      }

      if (guestCancelBtn) {
        guestCancelBtn.addEventListener('click', () => {
          guestModal?.classList.add('hidden');
        });
      }

    } catch (error) {
      console.error('Failed to load authentication module:', error);
      
      // Fallback error message
      const msgDiv = document.getElementById('login-status-message');
      if (msgDiv) {
        msgDiv.textContent = 'Authentication system failed to load. Please refresh the page.';
        msgDiv.className = 'text-red-600';
        msgDiv.style.opacity = 1;
      }
    }
  </script>
</body>
</html>

